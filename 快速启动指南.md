# 微信自动化服务 - 快速启动指南

## 一、环境准备（10分钟）

### 1. 检查系统要求
- ✅ Windows 10/11
- ✅ Python 3.7+
- ✅ 微信 PC 客户端

### 2. 安装依赖包

打开 PowerShell 或命令提示符，进入项目目录：

```powershell
cd E:\wechat\winappdriver
pip install -r requirements.txt
```

等待安装完成，确保没有错误。

### 3. 配置文件

首次使用需要复制配置文件示例：

```powershell
# 复制配置文件
Copy-Item config.json.example config.json

# 编辑配置文件（修改 token 等）
notepad config.json
```

**重要**：请修改 `token` 字段为您自己的密钥。

## 二、启动服务（1分钟）

### 1. 启动微信
- 打开微信 PC 客户端
- 确保已登录
- 可以最小化，但不要关闭

### 2. 启动自动化服务

```powershell
python app.py
```

看到以下输出表示启动成功：

```
========================================
微信自动化服务已启动
监听地址: http://127.0.0.1:8808
API 端点: POST http://127.0.0.1:8808/
状态查询: GET http://127.0.0.1:8808/status
健康检查: GET http://127.0.0.1:8808/health
========================================
```

## 三、测试服务（2分钟）

### 方法一：使用测试脚本（推荐）

打开**新的** PowerShell 窗口（保持 app.py 运行）：

```powershell
python test/test_api.py
```

按提示进行测试。

### 方法二：使用 PowerShell 手动测试

```powershell
$body = @{
    token = "123123"
    action = "sendtext"
    to = @("线报转发")
    content = "测试消息 $(Get-Date -Format 'HH:mm:ss')"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:8808/" -Method Post -Body $body -ContentType "application/json"
```

### 方法三：使用 Python 测试

创建一个简单的测试文件 `quick_test.py`：

```python
import requests

url = "http://127.0.0.1:8808/"
data = {
    "token": "123123",
    "action": "sendtext",
    "to": ["线报转发"],
    "content": "你好，这是测试消息"
}

response = requests.post(url, json=data)
print(response.json())
```

运行：
```powershell
python quick_test.py
```

## 四、查看结果

1. **查看日志文件**：
```powershell
Get-Content wechat_automation.log -Tail 20
```

2. **实时监控日志**：
```powershell
Get-Content wechat_automation.log -Wait
```

3. **检查微信**：
打开微信，查看是否成功发送消息给目标联系人。

## 五、常用操作

### 发送给单个联系人

```json
{
    "token": "123123",
    "action": "sendtext",
    "to": ["张三"],
    "content": "你好"
}
```

### 发送给多个联系人

```json
{
    "token": "123123",
    "action": "sendtext",
    "to": ["张三", "李四", "王五"],
    "content": "群发消息内容"
}
```

### 查询服务状态

```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:8808/status"
```

## 六、停止服务

在运行 `app.py` 的窗口按 `Ctrl+C`，服务会优雅关闭。

## 七、故障排查

### 问题 1: 提示"未找到微信窗口"
**解决**：
- 确保微信已启动
- 检查微信窗口标题是否为"微信"
- 尝试重新启动微信

### 问题 2: Token 验证失败
**解决**：
- 检查请求中的 token 是否为 "123123"
- 或修改 `config.json` 中的 token

### 问题 3: 找不到联系人
**解决**：
- 确认联系人名称拼写正确（区分大小写）
- 确认该联系人在你的微信列表中

### 问题 4: pip 安装失败
**解决**：
```powershell
# 使用国内镜像源
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 问题 5: 端口被占用
**解决**：
修改 `config.json` 中的 `port` 为其他值，如 8809。

## 八、下一步

- 📖 阅读 [使用说明.md](使用说明.md) 了解更多功能
- 🔧 修改 `config.json` 自定义配置
- 📝 查看 `wechat_automation.log` 了解运行日志
- 🚀 集成到你的应用程序中

## 技术支持

遇到问题？
1. 检查日志文件：`wechat_automation.log`
2. 查看完整文档：`使用说明.md`
3. 运行测试脚本：`python test/test_api.py`

